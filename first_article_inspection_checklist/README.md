# 首件檢查表系統需求規格書 (SRS)
## System Requirements Specification for First Article Inspection System

**文件版本**: 1.0  
**建立日期**: 2025-11-21  
**專案名稱**: MES 首件檢查表作業系統  
**文件狀態**: 待審核

---

## 📋 目錄

1. [概述](#1-概述)
2. [系統流程圖](#2-系統流程圖)
3. [系統範圍](#3-系統範圍)
4. [使用者角色與權限](#4-使用者角色與權限)
5. [功能需求](#5-功能需求)
6. [非功能需求](#6-非功能需求)
7. [資料需求](#7-資料需求)
8. [介面需求](#8-介面需求)
9. [業務規則](#9-業務規則)
10. [待釐清事項](#10-待釐清事項)
11. [附錄](#11-附錄)

---

## 1. 概述

### 1.1 目的
本系統旨在數位化製造產線的首件檢查作業流程，透過電子化表單管理、自動資料帶入、多層級簽核機制，提升首件檢查的效率與資料可追溯性。

### 1.2 範圍
- **涵蓋範圍**: 從產線人員登入、選擇製品類型、工單資料載入、檢查項目填寫、主管審核、製造/品保簽核，到表單歷史查詢
- **不涵蓋**: ERP系統工單管理、BOM表維護、生產排程系統

### 1.3 名詞定義

| 術語 | 定義 |
|------|------|
| 首件檢查表 | First Article Inspection (FAI) 表單，用於生產首批產品的品質檢驗 |
| 製品類型 | 產品大分類，如外機、內機、窗機等12種類型 |
| 工段 | 生產線上的工作段落，由主管分配給特定人員 |
| 檢查分類 | 首件檢查項目的分類，依製品類型而定，包含「其他」分類 |
| 暫存區 | 表單送出後進入的中間狀態區，分為審核者確認、製造簽核、品保簽核 |
| 結案 | 表單完成所有簽核流程，狀態變更為唯讀 |

---

## 2. 系統流程圖

### 2.1 MES 首件檢查表作業流程

下圖展示完整的首件檢查表作業流程，從產線人員登入到表單結案的所有步驟：

![MES 首件檢查表作業流程](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/Polo-Lin-TW/bd_docs/main/first_article_inspection_checklist/activeUML.puml)

> 💡 **提示**: 如果上方圖片無法顯示，請點擊 [這裡開啟 PlantUML 原始檔](./activeUML.puml)

**流程說明**:
- **產線人員**: 登入系統、選擇製品類型、輸入工單號碼、填寫檢查表
- **MES系統**: 驗證工單、載入檔頭資料、自動帶入BOM規格、判斷是否沿用昨日表單
- **產線主管**: 安排人員工段、審核表單、決定是否通過或退回
- **製造與品保**: 平行簽核流程，兩者皆通過後表單結案
- **管理者**: 具備修改已結案表單的權限，需記錄變更理由

**關鍵特點**:
1. **表單必定產生**: 無論沿用或新建，都必須產生今日表單並進入填寫介面
2. **自動儲存**: 每30秒自動儲存，避免資料遺失
3. **多層級簽核**: 主管 → (製造 || 品保) → 結案
4. **完整追溯**: 所有操作記錄Change Log，確保符合ISO品質要求

---

## 3. 系統範圍

### 3.1 系統邊界

```
┌─────────────────────────────────────────────────────────┐
│                    首件檢查表系統                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ 登入驗證  │  │ 表單管理  │  │ 簽核流程  │  │ 歷史查詢  │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────┘
         ↑                   ↑                   ↑
         │                   │                   │
    使用者登入         ERP工單系統          BOM主檔系統
```

### 3.2 系統互動

**外部系統整合**:
- **ERP系統**: 讀取工單檔頭資料（品牌、定變頻、工單號、台數、序號範圍、機種、機型）
- **BOM系統**: 讀取料件編號、規格資訊（如可取得）
- **人員管理系統**: 取得當日出勤人員名單

---

## 4. 使用者角色與權限

### 4.1 角色定義

| 角色代碼 | 角色名稱 | 產線別 | 主要職責 |
|---------|---------|--------|---------|
| B | B線操作人員 | B線 | 填寫首件檢查表 |
| P | P線操作人員 | P線 | 填寫首件檢查表 |
| C | C線操作人員 | C線 | 填寫首件檢查表 |
| SUPERVISOR | 產線主管 | 各線 | 安排人員、審核表單 |
| QA | 品保人員 | 品保部 | 品保簽核 |
| MFG_APPROVER | 製造簽核者 | 製造部 | 製造簽核 |
| MANAGER | 管理者 | 管理階層 | 完整權限 |

### 4.2 權限矩陣

| 功能 | B/P/C | SUPERVISOR | QA | MFG_APPROVER | MANAGER |
|------|-------|------------|----|--------------|----|
| 登入系統 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 選擇製品類型 | ✓ | ✓ | ✗ | ✗ | ✓ |
| 安排人員工段 | ✗ | ✓ | ✗ | ✗ | ✓ |
| 產生表單 | ✓ | ✓ | ✗ | ✗ | ✓ |
| 填寫檢查項目 | ✓ | ✓ | ✗ | ✗ | ✓ |
| 送出表單 | ✓ | ✓ | ✗ | ✗ | ✓ |
| 主管審核 | ✗ | ✓ | ✗ | ✗ | ✓ |
| 製造簽核 | ✗ | ✗ | ✗ | ✓ | ✓ |
| 品保簽核 | ✗ | ✗ | ✓ | ✗ | ✓ |
| 修改已送出表單 | ✗ | ✗ | ✗ | ✗ | ✓ |
| 修改已結案表單 | ✗ | ✗ | ✗ | ✗ | ✓ |
| 查詢歷史表單 | ✓ | ✓ | ✓ | ✓ | ✓ |

---

## 5. 功能需求

### 5.1 使用者登入 (FR-001)

**描述**: 系統依據產線別區分使用者帳號

**前置條件**: 
- 使用者已於系統註冊
- 使用者帳號狀態為啟用

**輸入**:
- 帳號 (username)
- 密碼 (password)
- 產線別 (line_code): B/P/C/QA/管理者

**處理流程**:
1. 驗證帳號密碼
2. 檢查使用者角色
3. 載入對應權限選單

**輸出**:
- 成功: 進入系統主選單
- 失敗: 顯示錯誤訊息

**非功能需求**:
- 密碼需加密儲存
- 登入失敗3次鎖定帳號10分鐘

---

### 5.2 選擇製品類型 (FR-002)

**描述**: 使用者登入後選取生產製品類型

**前置條件**: 
- 使用者已成功登入
- 使用者角色非QA（QA僅能進入簽核介面）

**輸入**:
- 製品類型選擇（單選）

**製品類型清單**:
1. 外機
2. 內機
3. 窗機
4. 送風機
5. 落地
6. 氣冷內機
7. 氣冷外機
8. 水冷式箱型機
9. 嵌入式
10. 熱泵
11. 除濕機
12. 吊隱式除濕機
13. 製冰機

**處理流程**:
1. 顯示製品類型選單
2. 讀取該製品類型的檢查分類主檔
3. 若該製品類型無「其他」分類，系統自動新增一筆
4. 快取選取的製品類型至當前會話

**輸出**:
- 進入工單輸入介面
- 系統記錄當前選擇的製品類型

**業務規則**:
- BR-002-01: 每個製品類型至少需包含一個「其他」檢查分類
- BR-002-02: 檢查分類由系統管理員預先建立並維護

---

### 5.3 安排人員工段 (FR-003)

**描述**: 主管依據當日出勤人員安排各工段的生產人員

**前置條件**: 
- 登入角色為SUPERVISOR或MANAGER
- 已選擇製品類型

**輸入**:
- 日期（預設為當日）
- 產線別
- 工段清單（依檢查分類動態產生）
- 人員選擇（多選，來自出勤名單）

**處理流程**:
1. 系統讀取當日出勤人員名單
2. 主管勾選各工段負責人員
3. 系統儲存當日人員配置 (line_assignment)
4. 若當日尚未安排人員，產線操作人員嘗試產生表單時顯示警示

**輸出**:
- 當日人員配置記錄
- 成功訊息

**業務規則**:
- BR-003-01: 未安排人員前，產線人員無法產生首件檢查表
- BR-003-02: 一個工段可分配給多位人員
- BR-003-03: 人員配置以「日期 + 產線別」為唯一鍵

**待釐清**:
- ❓ 安排人員的時機：是在選擇製品類型後立即要求，還是在嘗試產生表單時檢查？
- ❓ 若中途需調整人員，是否可重新安排？

---

### 5.4 輸入工單號碼與載入檔頭資料 (FR-004)

**描述**: 產線人員輸入工單號碼，系統自動載入工單檔頭資料

**前置條件**: 
- 已選擇製品類型
- 當日已安排人員

**輸入**:
- 工單號碼 (work_order_no)

**處理流程**:
1. 驗證工單號碼格式
2. 呼叫ERP API查詢工單檔頭資料
3. 解析工單主分群碼（製品類型碼）
4. 比對工單製品類型與當前選擇的製品類型
5. 若不一致，提示使用者重新執行「選擇製品類型」
6. 若一致，自動帶入以下資訊至表單檔頭:
   - 品牌
   - 定頻/變頻
   - 工單號碼
   - 生產台數
   - 起訖機號（序號範圍）
   - 機種
   - 機型
   - 日期（預設當日，可修改）

**輸出**:
- 成功: 表單檔頭資訊顯示
- 失敗: 錯誤訊息（工單不存在、連線失敗、類型不符等）

**業務規則**:
- BR-004-01: 工單號碼需符合公司編碼規則
- BR-004-02: 工單主分群碼必須與選擇的製品類型一致
- BR-004-03: 若工單載入失敗，顯示「工單載入失敗，請檢查ERP連線」

**待釐清**:
- ❓ ERP API的連線方式（REST API / SOAP / 資料庫直連）
- ❓ 工單主分群碼與製品類型的對照表

---

### 5.5 檢查是否沿用昨日表單 (FR-005)

**描述**: 若今日工單與昨日相同，詢問是否沿用昨日已結案的檢查資料

**前置條件**: 
- 工單號碼已載入成功
- 系統檢測到昨日同一工單已有結案表單

**輸入**:
- 使用者選擇: 
  - 沿用昨日資料
  - 產生空白表單

**處理流程**:

**若選擇「沿用昨日資料」**:
1. 系統查詢昨日同一工單的已結案表單
2. 建立今日新表單（新的表單ID）
3. 完整複製昨日表單的所有檢查項目數值
4. 自動更新表頭為今日日期
5. 自動更新台數、序號範圍（如有變動）
6. 自動帶入今日主管安排的人員
7. **仍需進入填寫介面進行確認**

**若選擇「產生空白表單」**:
1. 建立今日新表單（空白）
2. 僅帶入工單檔頭資訊
3. 進入填寫介面

**輸出**:
- 新表單記錄（狀態: Draft）
- 進入表單填寫介面

**業務規則**:
- BR-005-01: 「沿用」僅適用於昨日同一工單且已結案的表單
- BR-005-02: 即使沿用昨日資料，仍需進入填寫介面確認
- BR-005-03: 沿用時需記錄來源表單ID

**待釐清**:
- ❓ 原需求項9「僅需安排人員無需產生首件檢查表」與UML流程「建立今日新表單」存在矛盾，建議採用UML流程的做法，因為:
  - 每日仍需有完整的檢查記錄
  - 符合ISO品質追溯要求
  - 可應對昨日與今日的製程差異

---

### 5.6 自動帶入BOM規格資料 (FR-006)

**描述**: 系統自動從工單/BOM系統帶入料件編號、規格等資訊

**前置條件**: 
- 工單號碼已載入成功
- 表單檢查項目已產生

**處理流程**:
1. 系統判斷哪些檢查項目需要確認「品號」或「規格」
2. 呼叫BOM API查詢該工單的料件清單
3. 將料件編號、規格自動填入對應的檢核結果欄位
4. 標記該欄位為「系統自動帶入」，可手動修改

**輸出**:
- 檢核結果欄位預填資料

**業務規則**:
- BR-006-01: 僅限「需確認品號(料件編號)、規格」的檢查項目才自動帶入
- BR-006-02: 其餘欄位採用鍵盤輸入或手寫方式填寫
- BR-006-03: 自動帶入的資料仍可手動修改

**待釐清**:
- ❓ 需提供明確的「需自動帶入」欄位清單（品號、規格、其他？）
- ❓ 若BOM資料與實際不符，修改流程為何？

---

### 5.7 表單填寫介面 (FR-007)

**描述**: 產線人員進入檢查表填寫介面，進行實物檢查並記錄結果

**前置條件**: 
- 表單已產生（沿用或新建）
- 工單檔頭資訊已載入

**介面元素**:

**表單檔頭區（橘框區域）**:
- 品牌
- 定頻/變頻
- 工單號碼
- 生產台數
- 起訖機號
- 機種
- 機型
- 日期

**檢查項目區（紅框區域）**:
- 檢查分類（依製品類型動態顯示，含「其他」）
- 各分類下的檢查項目
- 檢核結果欄位:
  - 文字輸入框（鍵盤輸入）
  - 手寫簽名欄
  - 照片上傳按鈕
  - 數值輸入框
- 備註欄

**填表者資訊區**:
- 自動帶入當日人員配置
- 顯示各工段負責人員姓名

**功能按鈕**:
- 暫存
- 送出（主管審核）
- 取消

**處理流程**:
1. 系統顯示完整的檢查項目清單
2. 產線人員依序檢查並填寫
3. 系統每30秒自動儲存為Draft狀態
4. 使用者可隨時按「暫存」手動儲存
5. 填寫完成後按「送出」進入審核流程

**業務規則**:
- BR-007-01: 自動帶入的檔頭資料可手動修改
- BR-007-02: 填表者欄位依據「人員安排」自動帶入，不可修改
- BR-007-03: 手寫簽名需使用觸控筆或手指於螢幕上簽署
- BR-007-04: 照片檔案限制: jpg/png, 單檔不超過5MB

**待釐清**:
- ❓ 檢查項目是否有必填/選填的區分？
- ❓ 手寫欄位是使用Canvas繪圖還是整合第三方簽名元件？

---

### 5.8 自動儲存與未完成表單處理 (FR-008)

**描述**: 系統自動儲存填寫中的表單，隔日登入時處理未完成表單

**自動儲存機制**:
- 每30秒自動儲存至資料庫（狀態: Draft）
- 使用者按「暫存」立即儲存
- 儲存時不做必填欄位驗證

**未完成表單處理**:

**情境**: 昨日表單未填寫完成（狀態: Draft），今日再次登入

**處理流程**:
1. 系統偵測到有未完成的Draft表單
2. 彈出警示視窗:「昨日表單尚未完成，需重新安排人員」
3. 跳轉至「人員安排」介面
4. 主管重新指派人員後，才能繼續填寫

**輸出**:
- 表單持續保持Draft狀態
- 人員資訊更新為今日配置

**業務規則**:
- BR-008-01: Draft狀態表單不可送出審核
- BR-008-02: 隔日繼續填寫時必須重新安排人員
- BR-008-03: Draft表單保留7天，逾期自動刪除

**待釐清**:
- ❓ 自動儲存頻率是否可調整？
- ❓ 若主管未重新指派人員，原填寫人員是否可繼續編輯？

---

### 5.9 送出表單至主管審核 (FR-009)

**描述**: 產線人員填寫完成後，送出表單進入主管審核流程

**前置條件**: 
- 表單狀態為Draft
- 使用者為B/P/C或SUPERVISOR或MANAGER

**處理流程**:
1. 使用者按「送出」按鈕
2. 系統變更表單狀態為 `review_request`（待主管審核）
3. 系統推播通知至對應產線主管
4. 表單進入「審核者確認」暫存區

**輸出**:
- 表單狀態: review_request
- 通知主管有新表單待審核

**業務規則**:
- BR-009-01: 送出後，填寫人員不可再修改
- BR-009-02: 僅主管有權退回修改

---

### 5.10 主管審核表單 (FR-010)

**描述**: 主管登入「審核者確認」暫存區，檢查表單是否完整填寫

**前置條件**: 
- 表單狀態為 review_request
- 登入角色為SUPERVISOR或MANAGER

**處理流程**:

**步驟1: 檢查必填欄位**
- 系統自動標示空白的必填欄位
- 主管檢視表單內容

**步驟2: 審核決策**

**情境A: 必填欄位皆已填寫**
1. 主管在螢幕上手寫簽名
2. 系統一鍵將簽名複製至所有「審核者」欄位
3. 按「送出」
4. 系統同時推播至「製造簽核」與「品保簽核」暫存區
5. 狀態變更為 `pending_approval`

**情境B: 有空白必填欄位**
1. 系統彈出警示:「有空白欄位，是否強制送出？」
2. 主管選擇:
   - **強制送出**: 
     - 須輸入強制送出理由
     - 系統記錄強制送出註記
     - 簽名並同時推播至製造與品保簽核
   - **退回修改**:
     - 狀態退回 Draft
     - 通知原填寫人員

**輸出**:
- 表單狀態: pending_approval
- 主管簽名記錄
- （如有）強制送出理由

**業務規則**:
- BR-010-01: 主管簽名為手寫簽名（Canvas繪圖）
- BR-010-02: 強制送出需記錄理由，字數限制100字
- BR-010-03: 退回修改時需註明退回原因

**待釐清**:
- ❓ 「有填寫項目的審核者欄位」是指所有工段都需要主管簽名，還是僅有填寫資料的工段？

---

### 5.11 製造與品保平行簽核 (FR-011)

**描述**: 主管審核通過後，表單同時進入製造簽核與品保簽核流程

**前置條件**: 
- 表單狀態為 pending_approval
- 主管已完成審核

**製造簽核流程**:
1. MFG_APPROVER登入系統
2. 進入「待製造簽核」清單
3. 檢視表單內容
4. 決策:
   - **通過**: 手寫簽名，記錄製造簽核時間
   - **退回**: 輸入退回理由，狀態退回Draft

**品保簽核流程**:
1. QA人員登入系統
2. 進入「待品保簽核」清單
3. 檢視表單內容
4. 決策:
   - **通過**: 手寫簽名，記錄品保簽核時間
   - **退回**: 輸入退回理由，狀態退回Draft

**平行簽核邏輯**:
- 製造與品保可同時簽核，無先後順序
- 需等待兩者皆完成才能結案

**輸出**:
- 製造簽核記錄（簽名、時間）
- 品保簽核記錄（簽名、時間）

**業務規則**:
- BR-011-01: 製造與品保簽核為平行流程，無順序限制
- BR-011-02: 任一方退回，表單退回Draft，需重新送審
- BR-011-03: QA帳號僅有簽核權限，不可填寫或修改表單

**待釐清**:
- ❓ 原需求項12-14提到「審核者確認後才可於製造、品保簽核暫存區出現」，但UML顯示為「同時推播」，建議採用UML的平行簽核機制以提高效率

---

### 5.12 表單結案與唯讀 (FR-012)

**描述**: 主管、製造、品保三方皆完成簽核後，表單自動結案並設為唯讀

**前置條件**: 
- 表單狀態為 pending_approval
- 主管、製造、品保三方簽核皆完成

**處理流程**:
1. 系統檢查三方簽核狀態
2. 若皆已完成，狀態變更為 `closed`
3. 表單設為唯讀，一般使用者不可修改
4. 系統記錄結案時間
5. 通知所有相關人員表單已結案

**輸出**:
- 表單狀態: closed
- 結案時間戳記
- 唯讀標記

**業務規則**:
- BR-012-01: 結案後，B/P/C帳號完全不可修改
- BR-012-02: SUPERVISOR不可修改已結案表單
- BR-012-03: 僅MANAGER可修改已結案表單（需記錄理由）

---

### 5.13 管理者修改已結案表單 (FR-013)

**描述**: 管理者具備修改已結案表單的權限，需記錄變更紀錄

**前置條件**: 
- 表單狀態為 closed
- 登入角色為MANAGER

**處理流程**:
1. MANAGER進入已結案表單
2. 點選「修改」按鈕
3. 系統彈出「修改理由」輸入框（必填）
4. 輸入理由後，表單解鎖可編輯
5. 修改完成後按「儲存」
6. 系統記錄Change Log:
   - 修改時間
   - 修改人員
   - 修改理由
   - 修改前數值
   - 修改後數值
7. 系統自動重新觸發簽核流程（狀態退回 pending_approval）

**輸出**:
- Change Log記錄
- 表單狀態: pending_approval
- 通知相關簽核人員

**業務規則**:
- BR-013-01: 修改理由為必填，字數限制200字
- BR-013-02: Change Log永久保存，不可刪除
- BR-013-03: 修改後需重新完成所有簽核流程

---

### 5.14 歷史表單查詢 (FR-014)

**描述**: 提供多條件查詢介面，檢索歷史首件檢查表

**前置條件**: 
- 使用者已登入
- 具備查詢權限（所有角色皆可）

**查詢條件**:
- 工單號碼（模糊搜尋）
- 日期範圍（起訖日期）
- 機型（下拉選單，支援多選）
- 製品類型（下拉選單）
- 產線別（B/P/C）
- 表單狀態（Draft/review_request/pending_approval/closed）

**處理流程**:
1. 使用者輸入查詢條件
2. 系統執行SQL查詢
3. 顯示查詢結果清單（分頁顯示，每頁20筆）
4. 點選表單可檢視完整內容
5. 可匯出為PDF或Excel

**輸出**:
- 查詢結果清單
- 表單明細檢視
- 匯出檔案

**業務規則**:
- BR-014-01: 表單至少保存3年
- BR-014-02: 3年後可選擇歸檔至備份系統
- BR-014-03: 所有角色皆可查詢，但僅能查看有權限的產線資料

---

## 6. 非功能需求

### 6.1 效能需求

| 項目 | 指標 |
|------|------|
| 系統回應時間 | 一般操作 < 2秒，查詢操作 < 5秒 |
| 並行使用者數 | 支援至少50人同時線上操作 |
| 資料庫查詢效能 | 歷史表單查詢（3年資料）< 5秒 |
| 檔案上傳速度 | 5MB照片上傳 < 10秒 |
| 自動儲存頻率 | 每30秒執行一次 |

### 6.2 可用性需求

- 系統可用率: 99% (每月停機時間 < 7.2小時)
- 支援7x24運作（配合產線三班制）
- 定期維護時間: 每月第一個週日 02:00-06:00

### 6.3 安全性需求

- 密碼強度: 至少8碼，包含英數字
- 登入失敗3次鎖定帳號10分鐘
- 所有操作記錄Audit Log
- 資料傳輸使用HTTPS加密
- 敏感資料（如密碼）加密儲存

### 6.4 相容性需求

**瀏覽器支援**:
- Chrome 90+
- Edge 90+
- Safari 14+
- Firefox 88+

**裝置支援**:
- 桌機 (Windows 10+)
- 平板 (Android 9+, iOS 13+)
- 手寫裝置 (支援觸控筆)

### 6.5 備份與復原

- 資料庫每日自動備份
- 備份保留30天
- 系統災難復原時間目標(RTO): 4小時
- 資料復原點目標(RPO): 1小時

---

## 7. 資料需求

### 7.1 主要資料實體

#### 7.1.1 表單主檔 (inspection_form)

| 欄位名稱 | 資料型別 | 說明 | 範例 |
|---------|---------|------|------|
| form_id | VARCHAR(50) | PK, 表單ID | FAI-20251121-B-001 |
| work_order_no | VARCHAR(30) | 工單號碼 | WO-2024-12345 |
| product_type | VARCHAR(20) | 製品類型 | 外機 |
| line_code | VARCHAR(10) | 產線別 | B |
| form_date | DATE | 表單日期 | 2025-11-21 |
| brand | VARCHAR(50) | 品牌 | Brand A |
| frequency_type | VARCHAR(20) | 定頻/變頻 | 變頻 |
| quantity | INT | 生產台數 | 100 |
| serial_start | VARCHAR(30) | 起始機號 | A001 |
| serial_end | VARCHAR(30) | 結束機號 | A100 |
| model_code | VARCHAR(50) | 機種 | AC-001 |
| model_name | VARCHAR(100) | 機型 | 冷氣機型A |
| status | VARCHAR(20) | 狀態 | Draft/review_request/pending_approval/closed |
| is_reused | BOOLEAN | 是否沿用昨日 | TRUE |
| source_form_id | VARCHAR(50) | 來源表單ID | FAI-20251120-B-001 |
| created_by | VARCHAR(50) | 建立人 | user001 |
| created_at | TIMESTAMP | 建立時間 | 2025-11-21 08:00:00 |
| submitted_at | TIMESTAMP | 送出時間 | 2025-11-21 10:30:00 |
| closed_at | TIMESTAMP | 結案時間 | 2025-11-21 14:00:00 |

#### 7.1.2 檢查項目明細 (inspection_item)

| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| item_id | VARCHAR(50) | PK, 項目ID |
| form_id | VARCHAR(50) | FK, 表單ID |
| category | VARCHAR(50) | 檢查分類 |
| item_no | INT | 項目編號 |
| item_name | VARCHAR(200) | 檢查項目名稱 |
| spec_required | VARCHAR(500) | 規格要求 |
| check_result | TEXT | 檢核結果 |
| is_auto_filled | BOOLEAN | 是否自動帶入 |
| signature_data | TEXT | 手寫簽名(Base64) |
| photo_url | VARCHAR(500) | 照片路徑 |
| remarks | TEXT | 備註 |
| checked_by | VARCHAR(50) | 檢查人員 |

#### 7.1.3 人員配置 (line_assignment)

| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| assignment_id | VARCHAR(50) | PK |
| line_code | VARCHAR(10) | 產線別 |
| assign_date | DATE | 配置日期 |
| category | VARCHAR(50) | 工段/分類 |
| user_id | VARCHAR(50) | 人員ID |
| user_name | VARCHAR(100) | 人員姓名 |

#### 7.1.4 簽核記錄 (approval_log)

| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| log_id | VARCHAR(50) | PK |
| form_id | VARCHAR(50) | FK, 表單ID |
| approval_type | VARCHAR(20) | 簽核類型: SUPERVISOR/MFG/QA |
| approver_id | VARCHAR(50) | 簽核人ID |
| approver_name | VARCHAR(100) | 簽核人姓名 |
| signature_data | TEXT | 簽名(Base64) |
| approval_result | VARCHAR(20) | 結果: APPROVED/REJECTED |
| reject_reason | TEXT | 退回理由 |
| approved_at | TIMESTAMP | 簽核時間 |

#### 7.1.5 變更記錄 (change_log)

| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| log_id | VARCHAR(50) | PK |
| form_id | VARCHAR(50) | FK, 表單ID |
| changed_by | VARCHAR(50) | 修改人 |
| change_reason | TEXT | 修改理由 |
| field_name | VARCHAR(100) | 欄位名稱 |
| old_value | TEXT | 修改前數值 |
| new_value | TEXT | 修改後數值 |
| changed_at | TIMESTAMP | 修改時間 |

### 7.2 參考資料表

- product_type_master: 製品類型主檔
- inspection_category_master: 檢查分類主檔
- user_master: 使用者主檔
- work_order_header: 工單檔頭（來自ERP）
- bom_master: BOM主檔（來自ERP）

---

## 8. 介面需求

### 8.1 外部系統介面

#### 8.1.1 ERP工單系統

**介面名稱**: GetWorkOrderHeader  
**通訊協定**: REST API / SOAP (待確認)  
**方法**: GET  
**輸入參數**:
```json
{
  "work_order_no": "WO-2024-12345"
}
```
**輸出參數**:
```json
{
  "work_order_no": "WO-2024-12345",
  "brand": "Brand A",
  "frequency_type": "變頻",
  "quantity": 100,
  "serial_start": "A001",
  "serial_end": "A100",
  "model_code": "AC-001",
  "model_name": "冷氣機型A",
  "product_type_code": "01"
}
```

#### 8.1.2 BOM系統

**介面名稱**: GetBOMItems  
**通訊協定**: REST API (待確認)  
**方法**: GET  
**輸入參數**:
```json
{
  "work_order_no": "WO-2024-12345",
  "model_code": "AC-001"
}
```
**輸出參數**:
```json
{
  "items": [
    {
      "item_no": "P001",
      "item_name": "壓縮機",
      "spec": "3HP"
    }
  ]
}
```

### 8.2 使用者介面

**主要畫面**:
1. 登入畫面
2. 製品類型選擇畫面
3. 人員安排畫面（主管專用）
4. 工單輸入畫面
5. 表單填寫畫面
6. 主管審核畫面
7. 簽核畫面（製造/品保）
8. 歷史查詢畫面

**UI/UX要求**:
- 響應式設計（RWD），支援桌機與平板
- 支援手寫輸入（Canvas / 第三方簽名元件）
- 支援照片拍攝與上傳
- 操作流程需符合產線作業習慣（快速、直覺）

---

## 9. 業務規則

### 9.1 表單生成規則

- BR-001: 每日每條產線的每個工單僅能產生一張首件檢查表
- BR-002: 產生表單前必須完成「選擇製品類型」與「安排人員」
- BR-003: 工單製品類型必須與選擇的製品類型一致

### 9.2 簽核流程規則

- BR-004: 簽核順序: 主管 → (製造 || 品保) → 結案
- BR-005: 製造與品保簽核為平行流程，無先後順序
- BR-006: 任一簽核者退回，表單退回Draft，需重新送審
- BR-007: 結案後僅MANAGER可修改，需記錄理由並重新簽核

### 9.3 權限規則

- BR-008: B/P/C帳號無修改已送出表單的權限
- BR-009: QA帳號僅有簽核權限，不可填寫表單
- BR-010: MANAGER具備所有功能權限

### 9.4 資料保留規則

- BR-011: Draft表單保留7天，逾期自動刪除
- BR-012: 已結案表單至少保存3年
- BR-013: Change Log永久保存

---

## 10. 待釐清事項

### 10.1 高優先級

| 編號 | 問題描述 | 建議方案 | 待確認方 |
|------|---------|---------|---------|
| Q-001 | 「沿用昨日資料」是否仍需產生新表單？ | 建議產生新表單但預填昨日數據，符合追溯要求 | 業務單位 |
| Q-002 | 人員安排的時機為何？ | 建議在登入後、選擇製品類型後立即檢查 | 業務單位 |
| Q-003 | 簽核流程是「主管→製造→品保」還是「主管→(製造||品保)」？ | UML採用平行簽核，效率較高 | 業務單位 |
| Q-004 | ERP API的連線方式？ | 需技術部門提供API文件 | IT部門 |

### 10.2 中優先級

| 編號 | 問題描述 | 建議方案 | 待確認方 |
|------|---------|---------|---------|
| Q-005 | 哪些欄位需從BOM自動帶入？ | 需業務單位提供明確清單 | 業務單位 |
| Q-006 | 檢查項目是否有必填/選填區分？ | 建議設定必填欄位清單 | 業務單位 |
| Q-007 | 自動儲存頻率是否可調整？ | 建議提供系統參數設定 | IT部門 |
| Q-008 | 手寫簽名採用Canvas還是第三方元件？ | 建議評估Signature Pad套件 | 開發團隊 |

### 10.3 低優先級

| 編號 | 問題描述 | 建議方案 | 待確認方 |
|------|---------|---------|---------|
| Q-009 | 是否需要手機APP版本？ | 建議先完成Web RWD版本 | 專案經理 |
| Q-010 | 是否需要離線模式？ | 建議Phase 2評估 | 專案經理 |

---

## 11. 附錄

### 11.1 製品類型與主分群碼對照表

| 製品類型 | 主分群碼 | 備註 |
|---------|---------|------|
| 外機 | 01 | 待ERP確認 |
| 內機 | 02 | 待ERP確認 |
| 窗機 | 03 | 待ERP確認 |
| ... | ... | ... |

### 11.2 檢查分類範例

**外機類型檢查分類**:
1. 外觀檢查
2. 尺寸檢查
3. 電氣檢查
4. 性能檢查
5. 其他（系統自動新增）

### 11.3 參考文件

- 原始需求文件: `First_Article_Inspection_Checklist.docx`
- UML流程圖: `MES首件檢查表作業流程.puml`
- ISO 9001品質管理系統要求

### 11.4 專有名詞縮寫

| 縮寫 | 全名 | 中文 |
|------|------|------|
| FAI | First Article Inspection | 首件檢查 |
| SRS | System Requirements Specification | 系統需求規格書 |
| MES | Manufacturing Execution System | 製造執行系統 |
| BOM | Bill of Materials | 物料清單 |
| ERP | Enterprise Resource Planning | 企業資源規劃 |
| QA | Quality Assurance | 品質保證 |
| RWD | Responsive Web Design | 響應式網頁設計 |

---

## 📝 文件修訂記錄

| 版本 | 日期 | 修訂人 | 修訂內容 |
|------|------|--------|---------|
| 1.0 | 2025-11-21 | Claude | 初版完成，根據原始需求與UML流程圖產生 |

---

**文件結束**